@model IEnumerable<Njh.Kernel.Models.DTOs.NavItem>

@{
    var parentPageTitle = Model.First().DisplayTitle;
    var parentPageLink = Model.First().Link;
}

<!-- Aside / DOES NOT load on mobile -->
<aside class="subpage__aside">
    <!-- NJHK13-388 Left Rail Nav -->
    @* TODO replace Skip Navigation text, aria labels, etc. with resource strings *@
    <a href="#subpageContent"
       class="subpage__aside-nav-skip visually-hidden-focusable">
        Skip Navigation
    </a>

    @* The first navItem in the model should be the parent of the current page, and displays a heading *@
    <nav class="subpage__aside-nav" aria-label="Sibling Pages">
        <ul role="list" class="subpage__aside-nav-list">
            <!-- Single Item for the parent page. -->
            <!-- This is to let the user know all the navigation is based around the parent page. -->
            <li class="subpage__aside-nav-item subpage__aside-nav-parent">
                <h2><a href="@parentPageLink">@parentPageTitle</a></h2>

                @* the rest of the menu should be children of the parent: current page, siblings if any, and their descendants. *@
                <ul class="subpage__aside-nav-list">
                    @foreach (var link in Model.First().Children)
                    {
                        @if (!link.Children.Any())
                        {
                            <li class="subpage__aside-nav-item@(link.IsOnPath ? " is-self" : "")" 
                                id="asideNavItem_@link.NodeID">
                                <a href="@link.Link">@link.DisplayTitle</a>
                            </li>
                        }
                        else
                        {
                            <li class="subpage__aside-nav-item has-children@(link.IsOnPath ? " is-self" : "")"
                                id="asideNavItem_@link.NodeID">
                                <div class="subpage__aside-nav-dropdown">
                                    <button type="button"
                                        class="subpage__aside-nav-trigger"
                                        id="asideNavItem_@(link.NodeID)_label"
                                        aria-label="Self sub menu"
                                        data-bs-toggle="collapse"
                                        aria-expanded="true"
                                        data-bs-target="#asideNavItem_@(link.NodeID)_children"
                                        aria-controls="asideNavItem_@(link.NodeID)_children">
                                        <span class="app-icon icon-dropdown"></span>
                                    </button>
                                    <a href="@link.Link">@link.DisplayTitle</a>
                                </div>
                                <ul class="subpage__aside-nav-list collapse show"
                                    id="asideNavItem_@(link.NodeID)_children"
                                    aria-hidden="false"
                                    aria-labeledby="asideNavItem_@(link.NodeID)_label">
                                    @foreach (var child in link.Children)
                                    {
                                        <li class="subpage__aside-nav-item" id="asideNavItem_@(child.NodeID)">
                                            <a href="@child.Link">@child.DisplayTitle</a>
                                        </li>
                                    }
                                </ul>
                            </li>
                        }
                    }
                </ul>
            </li>
        </ul>
    </nav>

</aside>
